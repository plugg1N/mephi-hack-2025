# Хакатон Nuclear IT Hack МИФИ
## Решение трека "След космического луча"

![ШАЛ](https://vr.mephi.ru/sites/default/files/inline-images/EAS_Picture.jpg)

В связи с тем, что в Техническом Задании не было sample-файла для создания автоматизированного скрипта и загрузки решения, решением нашей команды
будет являться исследование данных и проверка гипотез для определения <b> мощности, возраста, координат оси (X,Y) и Зенита и Азимута ШАЛ </b> в формате `.ipynb`.

___

# Ход исследования данных

<img width="757" height="628" alt="image" src="https://github.com/user-attachments/assets/6d837187-d72d-42fa-840e-22b313cd39f6" />

Каждый признак был описан а данном текстовом файле. Целевые переменные и некоторые важные факторы были заранее подготовлены организаторами. Остальные
исследование проводились командой.

В качестве полезных признаков были выделены следующие:
- PART0; // первичная частица: 14 - p (протон), 5626 - Fe (ядро железа)
- E0; // энергия первичной частицы (ГэВ)
- NGAM; // число гамма-квантов с энергией >= 0.00005 ГэВ  в ШАЛ на уровне наблюдения
- NEL; // число электронов (и позитронов) (с энергией >= 0.00005 ГэВ) в ШАЛ на уровне наблюдения
- NHADR; // число адронов (с энергией >= 0.05 ГэВ) в ШАЛ на уровне наблюдения 
- NMU; //  число мюонов (с энергией >= 0.01 ГэВ) в ШАЛ на уровне наблюдения
- EdepCntSCT[9][5][2]; // энерговыделение в счетчиках СКТ - плоскость (Y), счетчик (X), <b> нижний(0) / верхний(1) </b>
- EdepStNE[9][4]; // энерговыделение в станциях установки НЕВОД-ШАЛ (МэВ) - кластер, станция

Была выделена следующая информация о признаках:

```python
# Рассредоточение кортежа информации на отельные факторы
data[[f'x{i+1}' for i in range(36)]] = pd.DataFrame(data['energy'].tolist(), index=data.index) # для энергии
data[[f'y{i+1}' for i in range(2)]] = pd.DataFrame(data['edep'].tolist(), index=data.index)    # для энерговыделение в счетчиках СКТ

# Синус азимута
data['phi_sin'] = np.sin(np.deg2rad(data['phi']))

# Сумма всех вторичных частиц
data['secondary_particles_amount'] = data['NEL'] + data['NGAM'] + data['NMU']

# Данные о кортеже энергии
data['max_energy'] =  data['energy'].apply(max)
data['sum_energy'] =  data['energy'].apply(sum)
data['mean_energy'] = data['energy'].apply(lambda x: np.mean(x))

data.drop(columns=['phi'], inplace=True)

energy = data['energy'].values.tolist()
data.drop(columns=['energy'], inplace=True)
data.drop(columns=['edep'], inplace=True)
```

Данные признаки были выбраны в соответствии с исследованиями, посвященными изучению ШАЛ. Информация о первичной частице, количество различных вторичных частиц
и их энергия напрямую указывают на мощность ливня и возраст.

___

### На <i> координаты оси и Зенит с Азимутом </i> влияет распределение времени детекции частиц и количество определенной детекторами энергией.

Для получения средневзвешенного (в целях определения координат оси ШАЛ) была составлена схема центра МИФИ.

<img width="368" height="321" alt="image" src="https://github.com/user-attachments/assets/5cb88d2f-e838-44a9-8b30-efd8c5c216ee" />
<img width="368" height="321" alt="image" src="https://github.com/user-attachments/assets/54e638af-22b5-4026-9f50-e65b42ff3e0a" />

Размер круга показывает насколько сильная суммарная энергия частиц поступила на детекторы в определенном класторе.

___

Также была построена модель последовательности активации детекторов, основываясь на времени фиксации излучения.

<img width="583" height="562" alt="image" src="https://github.com/user-attachments/assets/75490ec0-0dc1-418c-bfcf-961cbf80d4a3" />

Однако не получилось выявить последовательность, т.к. некоторые объекты из датасета не подвегрались интерпретируемому объяснению конкретной последовательности.
Было принято решение сфокусироваться на повышении точности других признаков.

___

# Точность модели

Была использована следующая конфигурация CatBoost:
```python
model = catboost.CatBoostRegressor(
    iterations=20_000,
    learning_rate=0.05,
    early_stopping_rounds=1000,
    depth=3,
    task_type="GPU",
    verbose=5_000)
```

## Определение мощности и возраста

<img width="496" height="287" alt="image" src="https://github.com/user-attachments/assets/49335d90-0364-4484-a5ce-5230399aa02d" />

## Определение координат оси (X, Y) через взвешенное

$$ \Large \text {MAE X: 9.92, MAE Y: 15.88} $$

## Определение координат оси (X, Y) Машинное Обучение

<img width="668" height="297" alt="image" src="https://github.com/user-attachments/assets/25566a4d-90ef-4066-a669-e0a8318da156" />

## Определение направления луча

Угол $\theta \text { - зенит (0-50}\degree \text{) угол между нормалью к плоскости и проекцией касательной к ней}$

MAE: 4.45401145108177

$R^2$: 0.7459592531829253

___

Угол $\phi \text { - азимут (0-360}\degree \text{), по часовой стрелке относительно направления к Северу}$

MAE: 0.5258692443485505

$R^2$: 0.2340761569031381

___

# Заключение

В рамках данного конкурса мы изучили множество исследований, опираясь на которые команда сумела создать полезные признаки, которые
существенно увеличивают точность модели машинного обучения.

- Задача определения мощности и возраста была решена с высокой точностью.
- Координаты оси определяются с средней погрешностью в 6 метров.
- Определение зенита с погрешностью в 4.5 градуса.
- Определение синуса азимута вызвало наибольшие затруднения, т.к. не удалось найти переменные, которые смогли бы дать полезную информацию для этой переменной. Средняя погрешность по синусу - 0.5.


